@model CursinhoEACH.DTO.MockDetailDTO
@{
    ViewData["Title"] = "Detalhes do Simulado";
    
    // Cores originais do seu layout
    string corCertas = "#5492ca";  // Azul
    string corErradas = "#ef7b1b"; // Laranja
    string corBranco = "#0b2440";  // Azul Escuro
}

<div class="mb-3">
    <a class="btn btn-outline-secondary btn-no-focus" href="@(Context.Request.Query["return"].ToString() ?? "/Mock")">Voltar</a>
</div>

<h4 class="mb-1">Simulado #@Model.Id - @Model.Titulo</h4>
<p class="text-muted mb-2">Data: @Model.Data.ToString("dd/MM/yyyy HH:mm") | Turma: @Model.Turma</p>

<div class="d-flex flex-wrap align-items-center gap-3 mb-3">
    <div class="p-2 border rounded bg-light" style="min-width:160px;">
        <div class="small text-muted">Média da turma</div>
        <div class="fs-5 fw-semibold">@Model.MediaGeral.ToString("F2")</div>
    </div>
    <div class="p-2 border rounded bg-light" style="min-width:160px;">
        <div class="small text-muted">Evolução vs anterior</div>
        <div class="fs-5 fw-semibold @(Model.Evolucao >= 0 ? "text-success" : "text-danger")">
            @(Model.Evolucao >= 0 ? "+" : "")@Model.Evolucao.ToString("P1")
        </div>
    </div>
    <div class="p-2 border rounded bg-light" style="min-width:160px;">
        <div class="small text-muted">Alunos presentes</div>
        <div class="fs-5 fw-semibold">
            @Model.Presentes/@Model.TotalAlunos
        </div>
    </div>
</div>

<hr />

<div class="mb-4">
    <h6 class="mb-1 text-center">Desempenho (Questões)</h6>
    
    <div class="d-flex justify-content-center align-items-center gap-4 flex-wrap">
        
        <div class="rounded-circle border position-relative"
             style="width:240px; height:240px; display:flex; align-items:center; justify-content:center;
             background: conic-gradient(
                 @corCertas 0deg @(Model.AngleCertas)deg, 
                 @corErradas @(Model.AngleCertas)deg @(Model.EndAngleOrange)deg, 
                 @corBranco @(Model.EndAngleOrange)deg 360deg
             );">
             </div>
        
        <table class="table table-sm mb-0 align-self-center" style="max-width:260px; min-width:220px;">
            <thead>
                <tr>
                    <th>Categoria</th>
                    <th class="text-end">%</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge" style="background:@corCertas">&nbsp;</span> Certas</td>
                    <td class="text-end">@Model.PctCertas.ToString("F1")%</td>
                </tr>
                <tr>
                    <td><span class="badge" style="background:@corErradas">&nbsp;</span> Erradas</td>
                    <td class="text-end">@Model.PctErradas.ToString("F1")%</td>
                </tr>
                <tr>
                    <td><span class="badge" style="background:@corBranco">&nbsp;</span> Em branco</td>
                    <td class="text-end">@Model.PctBranco.ToString("F1")%</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<h6 class="mb-2">Desempenho por Matéria</h6>
<table class="table table-hover align-middle">
    <thead>
        <tr>
            <th>Matéria</th>
            <th>Questões certas</th>
            <th>Questões erradas</th>
            <th>Questões em branco</th>
        </tr>
    </thead>
    <tbody>
        @foreach(var mat in Model.Materias)
        {
        <tr>
            <td>@mat.Materia</td>
            <td class="text-success">@mat.Certas (@mat.PctCertas.ToString("F0")%)</td>
            <td class="text-danger">@mat.Erradas (@mat.PctErradas.ToString("F0")%)</td>
            <td class="text-muted">@mat.Branco (@mat.PctBranco.ToString("F0")%)</td>
        </tr>
        }
        @if(!Model.Materias.Any())
        {
            <tr><td colspan="4" class="text-center text-muted">Nenhum dado detalhado por matéria encontrado.</td></tr>
        }
    </tbody>
</table>